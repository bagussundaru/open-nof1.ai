'use client';\n\nimport React, { useState, useEffect } from 'react';\n\ninterface MultiTimeframeDashboardProps {\n  symbol?: string;\n}\n\nexport default function MultiTimeframeDashboard({ symbol = 'BTCUSDT' }: MultiTimeframeDashboardProps) {\n  const [analysis, setAnalysis] = useState<any>(null);\n  const [loading, setLoading] = useState(false);\n  const [error, setError] = useState<string | null>(null);\n  const [selectedTimeframe, setSelectedTimeframe] = useState('1h');\n  const [autoRefresh, setAutoRefresh] = useState(false);\n  \n  const timeframes = [\n    { key: '1m', label: '1M', color: '#ef4444' },\n    { key: '5m', label: '5M', color: '#f97316' },\n    { key: '15m', label: '15M', color: '#eab308' },\n    { key: '1h', label: '1H', color: '#22c55e' },\n    { key: '4h', label: '4H', color: '#3b82f6' },\n    { key: '1d', label: '1D', color: '#8b5cf6' }\n  ];\n\n  useEffect(() => {\n    fetchAnalysis();\n  }, [symbol]);\n\n  useEffect(() => {\n    if (autoRefresh) {\n      const interval = setInterval(fetchAnalysis, 60000); // Refresh every minute\n      return () => clearInterval(interval);\n    }\n  }, [autoRefresh, symbol]);\n\n  const fetchAnalysis = async () => {\n    setLoading(true);\n    setError(null);\n    \n    try {\n      const response = await fetch(`/api/ai/multi-timeframe?symbol=${symbol}&strategy=true`);\n      const data = await response.json();\n      \n      if (data.success) {\n        setAnalysis(data.data);\n      } else {\n        setError(data.error || 'Failed to fetch analysis');\n      }\n    } catch (err) {\n      setError('Network error occurred');\n      console.error('Error fetching multi-timeframe analysis:', err);\n    } finally {\n      setLoading(false);\n    }\n  };\n\n  const getSignalColor = (signal: string) => {\n    switch (signal) {\n      case 'STRONG_BUY': return '#16a34a';\n      case 'BUY': return '#22c55e';\n      case 'HOLD': return '#eab308';\n      case 'SELL': return '#ef4444';\n      case 'STRONG_SELL': return '#dc2626';\n      default: return '#6b7280';\n    }\n  };\n\n  const getRiskColor = (risk: string) => {\n    switch (risk) {\n      case 'LOW': return '#22c55e';\n      case 'MEDIUM': return '#eab308';\n      case 'HIGH': return '#ef4444';\n      case 'EXTREME': return '#dc2626';\n      default: return '#6b7280';\n    }\n  };\n\n  const TimeframeCard = ({ tf, data }: { tf: any; data: any }) => {\n    const isSelected = selectedTimeframe === tf.key;\n    \n    return (\n      <div \n        className={`p-4 rounded-lg border cursor-pointer transition-all ${\n          isSelected \n            ? 'border-blue-500 bg-blue-50 dark:bg-blue-900/20' \n            : 'border-gray-200 dark:border-gray-700 hover:border-gray-300'\n        }`}\n        onClick={() => setSelectedTimeframe(tf.key)}\n      >\n        <div className=\"flex items-center justify-between mb-2\">\n          <span \n            className=\"text-sm font-medium px-2 py-1 rounded\"\n            style={{ backgroundColor: tf.color + '20', color: tf.color }}\n          >\n            {tf.label}\n          </span>\n          <span \n            className=\"text-xs px-2 py-1 rounded font-medium\"\n            style={{ \n              backgroundColor: getSignalColor(data.signals.entry) + '20',\n              color: getSignalColor(data.signals.entry)\n            }}\n          >\n            {data.signals.entry}\n          </span>\n        </div>\n        \n        <div className=\"space-y-1 text-sm\">\n          <div className=\"flex justify-between\">\n            <span className=\"text-gray-600 dark:text-gray-400\">Trend:</span>\n            <span className={`font-medium ${\n              data.trend.direction === 'BULLISH' ? 'text-green-600' :\n              data.trend.direction === 'BEARISH' ? 'text-red-600' : 'text-gray-600'\n            }`}>\n              {data.trend.direction}\n            </span>\n          </div>\n          \n          <div className=\"flex justify-between\">\n            <span className=\"text-gray-600 dark:text-gray-400\">RSI:</span>\n            <span className={`font-medium ${\n              data.technicalIndicators.rsi > 70 ? 'text-red-600' :\n              data.technicalIndicators.rsi < 30 ? 'text-green-600' : 'text-gray-600'\n            }`}>\n              {data.technicalIndicators.rsi.toFixed(1)}\n            </span>\n          </div>\n          \n          <div className=\"flex justify-between\">\n            <span className=\"text-gray-600 dark:text-gray-400\">Confidence:</span>\n            <span className=\"font-medium\">\n              {(data.signals.confidence * 100).toFixed(1)}%\n            </span>\n          </div>\n        </div>\n      </div>\n    );\n  };\n\n  if (loading && !analysis) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n        <div className=\"flex items-center justify-center h-64\">\n          <div className=\"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500\"></div>\n          <span className=\"ml-3 text-gray-600 dark:text-gray-400\">Loading multi-timeframe analysis...</span>\n        </div>\n      </div>\n    );\n  }\n\n  if (error) {\n    return (\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n        <div className=\"text-center\">\n          <div className=\"text-red-500 text-lg font-medium mb-2\">Analysis Error</div>\n          <div className=\"text-gray-600 dark:text-gray-400 mb-4\">{error}</div>\n          <button \n            onClick={fetchAnalysis}\n            className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 transition-colors\"\n          >\n            Retry Analysis\n          </button>\n        </div>\n      </div>\n    );\n  }\n\n  if (!analysis) return null;\n\n  const selectedData = analysis.analysis.timeframes[selectedTimeframe];\n\n  return (\n    <div className=\"space-y-6\">\n      {/* Header */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n        <div className=\"flex items-center justify-between mb-4\">\n          <div>\n            <h2 className=\"text-2xl font-bold text-gray-900 dark:text-white\">\n              ðŸ“Š Multi-Timeframe Analysis\n            </h2>\n            <p className=\"text-gray-600 dark:text-gray-400\">{symbol}</p>\n          </div>\n          \n          <div className=\"flex items-center space-x-4\">\n            <label className=\"flex items-center\">\n              <input \n                type=\"checkbox\" \n                checked={autoRefresh}\n                onChange={(e) => setAutoRefresh(e.target.checked)}\n                className=\"mr-2\"\n              />\n              <span className=\"text-sm text-gray-600 dark:text-gray-400\">Auto Refresh</span>\n            </label>\n            \n            <button \n              onClick={fetchAnalysis}\n              disabled={loading}\n              className=\"px-4 py-2 bg-blue-500 text-white rounded hover:bg-blue-600 disabled:opacity-50 transition-colors\"\n            >\n              {loading ? 'Refreshing...' : 'Refresh'}\n            </button>\n          </div>\n        </div>\n\n        {/* Consensus Summary */}\n        <div className=\"grid grid-cols-1 md:grid-cols-4 gap-4\">\n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold\" style={{ color: getSignalColor(analysis.summary.consensusSignal) }}>\n              {analysis.summary.consensusSignal}\n            </div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">Consensus Signal</div>\n          </div>\n          \n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-blue-600\">\n              {(analysis.summary.confidence * 100).toFixed(1)}%\n            </div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">Confidence</div>\n          </div>\n          \n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold text-green-600\">\n              {(analysis.summary.timeframeAlignment * 100).toFixed(1)}%\n            </div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">Alignment</div>\n          </div>\n          \n          <div className=\"text-center\">\n            <div className=\"text-2xl font-bold\" style={{ color: getRiskColor(analysis.summary.overallRisk) }}>\n              {analysis.summary.overallRisk}\n            </div>\n            <div className=\"text-sm text-gray-600 dark:text-gray-400\">Risk Level</div>\n          </div>\n        </div>\n      </div>\n\n      {/* Timeframe Grid */}\n      <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n        <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">Timeframe Overview</h3>\n        <div className=\"grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-4\">\n          {timeframes.map(tf => (\n            <TimeframeCard \n              key={tf.key} \n              tf={tf} \n              data={analysis.analysis.timeframes[tf.key]} \n            />\n          ))}\n        </div>\n      </div>\n\n      {/* Selected Timeframe Details */}\n      {selectedData && (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n          <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">\n            {timeframes.find(tf => tf.key === selectedTimeframe)?.label} Timeframe Details\n          </h3>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            {/* Technical Indicators */}\n            <div>\n              <h4 className=\"font-medium mb-3 text-gray-900 dark:text-white\">Technical Indicators</h4>\n              <div className=\"space-y-2 text-sm\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">RSI:</span>\n                  <span className={`font-medium ${\n                    selectedData.technicalIndicators.rsi > 70 ? 'text-red-600' :\n                    selectedData.technicalIndicators.rsi < 30 ? 'text-green-600' : 'text-gray-900 dark:text-white'\n                  }`}>\n                    {selectedData.technicalIndicators.rsi.toFixed(2)}\n                  </span>\n                </div>\n                \n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">MACD:</span>\n                  <span className=\"font-medium text-gray-900 dark:text-white\">\n                    {selectedData.technicalIndicators.macd.macd.toFixed(4)}\n                  </span>\n                </div>\n                \n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">EMA 20:</span>\n                  <span className=\"font-medium text-gray-900 dark:text-white\">\n                    {selectedData.technicalIndicators.ema20.toFixed(2)}\n                  </span>\n                </div>\n                \n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">EMA 50:</span>\n                  <span className=\"font-medium text-gray-900 dark:text-white\">\n                    {selectedData.technicalIndicators.ema50.toFixed(2)}\n                  </span>\n                </div>\n                \n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">Support:</span>\n                  <span className=\"font-medium text-green-600\">\n                    {selectedData.technicalIndicators.support.toFixed(2)}\n                  </span>\n                </div>\n                \n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">Resistance:</span>\n                  <span className=\"font-medium text-red-600\">\n                    {selectedData.technicalIndicators.resistance.toFixed(2)}\n                  </span>\n                </div>\n              </div>\n            </div>\n\n            {/* Trend Analysis */}\n            <div>\n              <h4 className=\"font-medium mb-3 text-gray-900 dark:text-white\">Trend Analysis</h4>\n              <div className=\"space-y-2 text-sm\">\n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">Direction:</span>\n                  <span className={`font-medium ${\n                    selectedData.trend.direction === 'BULLISH' ? 'text-green-600' :\n                    selectedData.trend.direction === 'BEARISH' ? 'text-red-600' : 'text-gray-600'\n                  }`}>\n                    {selectedData.trend.direction}\n                  </span>\n                </div>\n                \n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">Strength:</span>\n                  <span className=\"font-medium text-gray-900 dark:text-white\">\n                    {selectedData.trend.strength.toFixed(1)}%\n                  </span>\n                </div>\n                \n                <div className=\"flex justify-between\">\n                  <span className=\"text-gray-600 dark:text-gray-400\">Confidence:</span>\n                  <span className=\"font-medium text-gray-900 dark:text-white\">\n                    {(selectedData.trend.confidence * 100).toFixed(1)}%\n                  </span>\n                </div>\n              </div>\n              \n              <div className=\"mt-4\">\n                <h5 className=\"font-medium mb-2 text-gray-900 dark:text-white\">Signal Reasoning</h5>\n                <p className=\"text-sm text-gray-600 dark:text-gray-400 leading-relaxed\">\n                  {selectedData.signals.reasoning}\n                </p>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/* Strategy Signal */}\n      {analysis.strategy && (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n          <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">ðŸŽ¯ Strategy Recommendation</h3>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4 mb-6\">\n            <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n              <div className=\"text-xl font-bold\" style={{ color: getSignalColor(analysis.strategy.action) }}>\n                {analysis.strategy.action}\n              </div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Action</div>\n            </div>\n            \n            <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n              <div className=\"text-xl font-bold text-blue-600\">\n                {(analysis.strategy.positionSize * 100).toFixed(1)}%\n              </div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Position Size</div>\n            </div>\n            \n            <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n              <div className=\"text-xl font-bold text-purple-600\">\n                {analysis.strategy.leverage}x\n              </div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Leverage</div>\n            </div>\n            \n            <div className=\"text-center p-4 bg-gray-50 dark:bg-gray-700 rounded-lg\">\n              <div className=\"text-xl font-bold\" style={{ color: getRiskColor(analysis.strategy.riskLevel) }}>\n                {analysis.strategy.riskLevel}\n              </div>\n              <div className=\"text-sm text-gray-600 dark:text-gray-400\">Risk Level</div>\n            </div>\n          </div>\n          \n          <div className=\"grid grid-cols-1 md:grid-cols-2 gap-6\">\n            <div>\n              <h4 className=\"font-medium mb-3 text-gray-900 dark:text-white\">Entry Conditions</h4>\n              <ul className=\"text-sm space-y-1\">\n                {analysis.strategy.metadata.entryConditions.map((condition: string, index: number) => (\n                  <li key={index} className=\"flex items-start\">\n                    <span className=\"text-green-500 mr-2\">âœ“</span>\n                    <span className=\"text-gray-600 dark:text-gray-400\">{condition}</span>\n                  </li>\n                ))}\n              </ul>\n            </div>\n            \n            <div>\n              <h4 className=\"font-medium mb-3 text-gray-900 dark:text-white\">Risk Factors</h4>\n              <ul className=\"text-sm space-y-1\">\n                {analysis.strategy.metadata.riskFactors.map((risk: string, index: number) => (\n                  <li key={index} className=\"flex items-start\">\n                    <span className=\"text-red-500 mr-2\">âš </span>\n                    <span className=\"text-gray-600 dark:text-gray-400\">{risk}</span>\n                  </li>\n                ))}\n              </ul>\n            </div>\n          </div>\n          \n          <div className=\"mt-4 p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg\">\n            <h4 className=\"font-medium mb-2 text-blue-900 dark:text-blue-100\">Strategy Reasoning</h4>\n            <p className=\"text-sm text-blue-800 dark:text-blue-200 leading-relaxed\">\n              {analysis.strategy.reasoning}\n            </p>\n          </div>\n        </div>\n      )}\n\n      {/* Key Insights */}\n      {analysis.summary.keyInsights && analysis.summary.keyInsights.length > 0 && (\n        <div className=\"bg-white dark:bg-gray-800 rounded-lg shadow-lg p-6\">\n          <h3 className=\"text-lg font-semibold mb-4 text-gray-900 dark:text-white\">ðŸ’¡ Key Insights</h3>\n          <div className=\"space-y-3\">\n            {analysis.summary.keyInsights.map((insight: string, index: number) => (\n              <div key={index} className=\"flex items-start p-3 bg-yellow-50 dark:bg-yellow-900/20 rounded-lg\">\n                <span className=\"text-yellow-500 mr-3 mt-0.5\">ðŸ’¡</span>\n                <span className=\"text-sm text-yellow-800 dark:text-yellow-200\">{insight}</span>\n              </div>\n            ))}\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}